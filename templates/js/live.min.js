var create_header,format_game_time,format_supply,game_id,graphs,load_completed,load_graphs,load_header,load_live_content,refresh_data,refresh_graphs,refresh_header,setup_chart_menu,update_header,update_timer,zeroes;Array.prototype.last=function(){return this[this.length-1]},graphs={minerals_income:{title:"Mineral income",allow_diff:!0},minerals_gathered:{title:"Total minerals gathered",allow_diff:!0},gas_income:{title:"Gas income",allow_diff:!0},gas_gathered:{title:"Total gas gathered",allow_diff:!0},supply_current:{title:"Current supply",allow_diff:!1}},game_id=-1,update_timer=void 0,zeroes=function(e,t){var a;for(null==t&&(t=2),a=""+e;a.length<t;)a="0"+a;return a},format_game_time=function(e){var t;return t="",e>3600&&(t+=""+Math.floor(e/3600)+":",e%=3600),t+(""+zeroes(Math.floor(e/60))+":"+zeroes(e%60))},load_live_content=function(){return game_id=$("#live_content").attr("data-game-id"),$.getJSON("/live/get/livestats/?id="+game_id,load_completed)},load_completed=function(e){return $("#live_content").empty(),load_header(e),setup_chart_menu(),load_graphs(e),update_timer=setInterval(refresh_data,1e3)},load_graphs=function(e){var t,a,r,i,l,n,s,d,o;s=e.stats,o=[];for(r in graphs)a=graphs[r],$("#live_content").append("<div id='live_"+r+"' class='live-chart'></div>"),i=function(){var e,t,a;for(a=[],e=0,t=s.length;t>e;e++)d=s[e],a.push([d[0].game_time,d[0][r]]);return a}(),l=function(){var e,t,a;for(a=[],e=0,t=s.length;t>e;e++)d=s[e],a.push([d[0].game_time,d[1][r]]);return a}(),n=[{id:"pla",name:e.pla.tag,data:i,linkedTo:"plb",showInLegend:!0},{id:"plb",name:e.plb.tag,data:l,linkedTo:"pla",showInLegend:!0}],a.allow_diff&&(t=function(){var e,t,a;for(a=[],e=0,t=s.length;t>e;e++)d=s[e],a.push([d[0].game_time,d[1][r]-d[0][r]]);return a}(),n.push({name:"Difference",data:t})),o.push($("#live_"+r).highcharts({title:{text:a.title},chart:{animation:!1},exporting:{enabled:!1},legend:{enabled:!1},tooltip:{crosshairs:!0,formatter:function(){var e,t,a,r,i;for(t="<small>"+format_game_time(this.x)+"</small> <table>",i=this.points,a=0,r=i.length;r>a;a++)e=i[a],n=e.series,t+="<tr><td> <span style='color: "+n.color+"'> "+n.name+" </span></td><td><b>"+e.y+"</b></td></tr>";return t+"</table>"},shared:!0,useHTML:!0},xAxis:{labels:{formatter:function(){return format_game_time(this.value)}}},plotOptions:{series:{marker:{enabled:!1}}},series:n}));return o},load_header=function(e){return create_header(),null!=e.stats[0]?update_header(e):void 0},setup_chart_menu=function(){var e,t,a;e=function(e){return $("#live_"+t(e))},t=function(e){return $(e).attr("data-chart")},$("#live_content").append("<div id='live_chart_menu'></div>");for(a in graphs)$("#live_chart_menu").append("<div class='live-menu-item' data-chart='"+a+"'></div>");return $(".live-menu-item").each(function(){var e;return e=t(this),$(this).append("<div class='live-menu-button-toggle'>"+graphs[e].title+"</div>")}),$(".live-menu-button-toggle").click(function(){return $("#live_"+t(this.parentElement)).toggle()})},refresh_data=function(){return $.getJSON("/live/get/livestats/?id="+game_id+"&latest=1",function(e){return refresh_graphs(e.stats),refresh_header(e)})},refresh_graphs=function(e){var t,a,r,i,l;for(l=[],r=0,i=graphs.length;i>r;r++)t=graphs[r],a=$("#live_"+t).highcharts().series,null!=e[0][0]&&a[0].addPoint([e[0][0].game_time,e[0][0][t]]),l.push(null!=e[0][1]?a[1].addPoint([e[0][1].game_time,e[0][1][t]]):void 0);return l},refresh_header=function(e){return null!=e.stats[0]?update_header(e):void 0},create_header=function(){return $("#live_content").append("<div id='live_header'></div>")},format_supply=function(e,t){var a;return a=""+e+"/"+t,e>t?"<span class='supply-capped'>"+a+"</span>":a},update_header=function(e){var t,a,r,i;return t=e.stats.last(),a=format_supply(t[0].supply_current,t[0].supply_cap),r=format_supply(t[1].supply_current,t[1].supply_cap),i=format_game_time(t[0].game_time),$("#live_header").html("<div class='live-player'> <div class='live-player-top-row'> <a href='/players/"+e.pla.id+"'> "+e.pla.tag+" </a> <div class='live-supply'>"+a+"</div> </div> <div class='live-player-bottom-row'> <div class='live-minerals'>"+t[0].minerals_current+"</div> <div class='live-gas'>"+t[0].gas_current+"</div> </div> </div> <div class='live-timer'>"+i+"</div> <div class='live-player'> <div class='live-player-top-row'> <div class='live-supply'>"+r+"</div> <a href='/players/"+e.plb.id+"'> "+e.plb.tag+" </a> </div> <div class='live-player-bottom-row'> <div class='live-gas'>"+t[1].gas_current+"</div> <div class='live-minerals'>"+t[1].minerals_current+"</div> </div> </div>")};